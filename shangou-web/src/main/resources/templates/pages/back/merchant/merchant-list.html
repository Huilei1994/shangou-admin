<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<div th:replace="fragment/js::js"></div>
<div th:replace="fragment/map::map"></div>
<style>
    /*修改layui表格的高度*/
    .layui-table-cell {
        height: auto;
    }
</style>
<body>
<div>

    <!--搜索框-->
    <div style="margin-top: 20px;margin-left: 50px">
        <form class="layui-form" method="post" style="display: flex ;flex-wrap:wrap;">

            <div class="layui-form-item form-inline">
                <label class="layui-form-label">手机号:</label>
                <div class="layui-input-block" style="width: 140px">
                    <input type="text" id="phone" name="phone" placeholder="请输入手机号" autocomplete="off"
                           class="layui-input">
                </div>
            </div>

            <div class="layui-form-item form-inline">
                <label class="layui-form-label">店铺名称:</label>
                <div class="layui-input-block" style="width: 140px">
                    <input type="text" id="shopName" name="shopName" placeholder="请输入店铺名称" autocomplete="off"
                           class="layui-input">
                </div>
            </div>

            <div class="layui-form-item form-inline">
                <label class="layui-form-label">店铺详情:</label>
                <div class="layui-input-block" style="width: 140px">
                    <input type="text" id="shopDetail" name="shopDetail" placeholder="请输入店铺详情" autocomplete="off"
                           class="layui-input">
                </div>
            </div>

            <div class="layui-form-item form-inline">
                <label class="layui-form-label">邮箱:</label>
                <div class="layui-input-block" style="width: 140px">
                    <input type="text" id="email" name="email" placeholder="请输入邮箱" autocomplete="off"
                           class="layui-input">
                </div>
            </div>


            <div class="layui-form-item form-inline">
                <label class="layui-form-label">联系人姓名:</label>
                <div class="layui-input-block" style="width: 140px">
                    <input type="text" id="contactName" name="contactName" placeholder="请输入联系人姓名" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-form-item form-inline">
                <label class="layui-form-label">门店区域:</label>
                <div class="layui-input-block" style="width: 140px">
                    <input type="text" id="pcd" name="pcd" placeholder="请输入门店区域" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-form-item form-inline">
                <label class="layui-form-label">街道地址:</label>
                <div class="layui-input-block" style="width: 140px">
                    <input type="text" id="address" name="address" placeholder="请输入联系人姓名" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-form-item form-inline">
                <label class="layui-form-label">审批状态:</label>
                <div class="layui-input-block" style="width: 140px">
                    <input type="text" id="approvalStatus" name="approvalStatus" placeholder="请输入审批状态"
                           autocomplete="off"
                           class="layui-input">
                </div>
            </div>

            <div class="input" style="margin-left: 35px">
                <label class="layui-form-label"></label>
                <button class="layui-btn layui-btn-normal" lay-filter="selectByInfo" lay-submit
                        id="selectByInfo">
                    搜索
                </button>
            </div>
        </form>
    </div>

    <!--需要渲染的表格-->
    <table id="merchantTable" lay-filter="merchantTable"></table>
</div>

<!--表头控件-->
<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="add">批量通过</button>
        <button class="layui-btn layui-btn-danger  layui-btn-sm" lay-event="delete">批量不通过</button>
        <button class="layui-btn layui-btn-warm layui-btn-sm" lay-event="dispatchmerchant">分配商户</button>
    </div>
</script>
<!--审核界面-->
<script type="text/html" id="checkStateForm">
    <form class="layui-form" style="display: flex ;flex-wrap:wrap;">
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">审批状态</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="approvalStatus" id="c_approvalStatus"
                       style="width: 200px" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">编号</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="merchantId" id="c_merchantId"
                       style="width: 200px" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">用户ID</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="userId" id="c_userId"
                       style="width: 200px" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">手机号</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="phone" id="c_phone"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">店铺名称</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="shopName" id="c_shopName"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">店铺详情</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="shopDetail" id="c_shopDetail"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">邮箱</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="email" id="c_email"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">联系人姓名</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="contactName" id="c_contactName"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">门店区域</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="pcd" id="c_pcd"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">详细的街道地址</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="address" id="c_address"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">用户输入的坐标</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="location" id="c_location"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">经度</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="lng" id="c_lng"
                       style="width: 200px" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">纬度</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="lat" id="c_lat"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">营业状态</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="isOpen" id="c_isOpen"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">店铺所在的街道</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="street" id="c_street"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">标语1</span>
            <div class="layui-input-block " style="width: 200px">
                <input type="text" name="title1" id="c_title1"
                       style="width: 200px" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">标语2</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="title2" id="c_title2"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">标语3</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="title3" id="c_title3"
                       style="width: 200px" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">最少起送价格</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="minPrice" id="c_minPrice"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">营业开始时间1</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="businessStartTime1" id="c_businessStartTime1"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">营业结束时间1</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="businessEndTime1" id="c_businessEndTime1"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">营业开始时间2</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="businessStartTime2" id="c_businessStartTime2"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">营业结束时间2</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="businessEndTime2" id="c_businessEndTime2"
                       style="width: 200px" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">省份</span>
            <div class="layui-input-block" style="width: 200px">
                <input type="text" name="province" id="c_province"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">主要经营类目id</span>
            <div class="layui-input-block">
                <input type="text" name="businessType" id="c_businessType"
                       style="width: 200px" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">外卖电话</span>
            <div class="layui-input-block">
                <input type="text" name="takeawayPhone" id="c_takeawayPhone"
                       style="width: 200px" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">是否开启了平台配送</span>
            <div class="layui-input-block">
                <input type="text" name="isPlatSend" id="c_isPlatSend"
                       style="width: 200px" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">创建时间</span>
            <div class="layui-input-block">
                <input type="text" name="createTime" id="c_createTime"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">最近更新时间</span>
            <div class="layui-input-block">
                <input type="text" name="updateTime" id="c_updateTime"
                       style="width: 200px" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item form-inline">

            <span class="layui-form-label">最大配送范围(单位:M)</span>
            <div class="layui-input-block">
                <input type="text" name="maxDeliveryArea" id="c_maxDeliveryArea"
                       style="width: 200px" class="layui-input">
            </div>

        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">门脸图</span>
            <div class="layui-input-block">
                <img src="" showBig width="200px" height="300px" name="doorImg" id="c_doorImg">
            </div>
        </div>

        <div class="layui-form-item form-inline">
            <span class="layui-form-label">室内图</span>
            <div class="layui-input-block">
                <img src="" showBig width="200px" height="300px" name="interiorImg" id="c_interiorImg">
            </div>
        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">店铺logo</span>
            <div class="layui-input-block" style="width: 200px">
                <img src="" showBig width="200px" height="300px" name="shopLogo" id="c_shopLogo">
            </div>
        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">安全许可证</span>
            <div class="layui-input-block" style="width: 200px">
                <img src="" showBig width="200px" height="300px" name="securityPermitImg" id="c_securityPermitImg">
            </div>
        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">法人身份证正面</span>
            <div class="layui-input-block">
                <img src="" showBig width="200px" height="300px" name="cardUserImg" id="c_cardUserImg">
            </div>
        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">法人身份证国徽面照片</span>
            <div class="layui-input-block">
                <img src="" showBig width="200px" height="300px" name="cardGuohuiImg" id="c_cardGuohuiImg">
            </div>
        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">法人手持身份证正面照片</span>
            <div class="layui-input-block">
                <img src="" showBig width="200px" height="300px" name="cardHandImg" id="c_cardHandImg">
            </div>

        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">营业执照图片</span>
            <div class="layui-input-block">
                <img src="" showBig width="200px" height="300px" name="businessLicenseImg" id="c_businessLicenseImg">
            </div>
        </div>
        <div class="layui-form-item form-inline">
            <span class="layui-form-label">其他凭证</span>
            <div class="layui-input-block">
                <img src="" showBig width="200px" height="300px" name="otherVoucherImg" id="c_otherVoucherImg">

            </div>
        </div>
        <div class="layui-form-item layui-form-text" style="width: 80%">
            <label class="layui-form-label"><h3>审批日志</h3></label>
            <div class="layui-input-block">
                <textarea name="note" id="note" placeholder="请输入内容" class="layui-textarea" style="width: 80%"></textarea>
            </div>
        </div>
    </form>
</script>
<!--日志表格-->
<script type="text/html" id="logDiv">
    <table id="approvalLogsTable" lay-filter="approvalLogsTable"></table>
</script>
<script type="text/html" id="showMerchantMap">
    <div><button class='layui-btn layui-btn-xs' lay-event='showMerchantMap'>查看</button></div>
</script>

<script th:inline="javascript" type="text/javascript">
    layui.use(['layer', 'table', 'form'], function () {
        // 我再js代码里边如何获取控制器传递过来的参数呢？
        let layer = layui.layer;// 弹出层
        let table = layui.table;// 分页组件
        let form = layui.form;// 分页组件
        let $ = layui.$;// 使用jquery

        //第一个实例
        let tb = table.render({// 渲染表格
            elem: '#merchantTable'
            , url: '/pages/back/merchant/ajaxList' //服务后台的数据接口
            , page: true //开启分页
            , cols: [[ //表头，这里是两个[[开头，两个]]结尾
                {field: '', type: 'checkbox', title: '多选'}
                , {
                    field: '', title: '操作', width: 75, templet: function (d) {// 这个d指的是本行的数据 js对象
                        return '<div>\n' +
                            '            <button class="layui-btn layui-btn-xs " lay-event="checkState">审核</button>\n' +
                            ' </div>'
                    }
                }, {field: 'approvalStatus', title: '审批状态', width: 100}
                , {field: 'merchantId', title: '编号', sort: true, width: 100}
                , {field: 'userId', title: '用户ID', width: 100}
                , {field: 'phone', title: '手机号', width: 100}
                , {field: 'shopName', title: '店铺名称', width: 100}
                , {
                    field: 'shopLogo', title: '店铺logo', width: 100, templet: function (d) {
                        let imgDiv = "<div><img showBig style='width: 50px;height: 50px;border-radius: 5px' src=" + d.shopLogo + "/></div>"
                        return imgDiv;
                    }
                }
                , {field: 'shopDetail', title: '店铺详情', width: 100}
                , {field: 'email', title: '邮箱', width: 100}
                , {field: 'contactName', title: '联系人姓名', width: 100}
                , {field: 'pcd', title: '门店区域', width: 100}
                , {field: 'address', title: '详细的街道地址', width: 100}
                , {field: 'location', title: '用户输入的坐标', width: 100}
                , {field: '', title: '坐标', width: 100,templet:'#showMerchantMap'}
                /*, {field: 'lng', title: '经度', width: 100}
                , {field: 'lat', title: '纬度', width: 100}*/
                , {field: 'isOpen', title: '营业状态', width: 100}
                , {field: 'street', title: '店铺所在的街道', width: 100}
                , {field: 'title1', title: '标语1', width: 100}
                , {field: 'title2', title: '标语2', width: 100}
                , {field: 'title3', title: '标语3', width: 100}
                , {field: 'minPrice', title: '最少起送价格', width: 100}
                , {field: 'businessStartTime1', title: '营业开始时间1', width: 100}
                , {field: 'businessEndTime1', title: '营业结束时间1', width: 100}
                , {field: 'businessStartTime2', title: '营业开始时间2', width: 100}
                , {field: 'businessEndTime2', title: '营业结束时间2', width: 100}
                , {field: 'province', title: '省份', width: 100}
                , {
                    field: 'doorImg', title: '门脸图', width: 100, templet: function (d) {
                        let imgDiv = "<div><img showBig style='width: 50px;height: 50px;border-radius: 5px' src=" + d.doorImg + "/></div>"
                        return imgDiv;
                    }
                }
                , {
                    field: 'interiorImg', title: '室内图', width: 100, templet: function (d) {
                        let imgDiv = "<div><img showBig style='width: 50px;height: 50px;border-radius: 5px' src=" + d.interiorImg + "/></div>"
                        return imgDiv;
                    }
                }
                , {field: 'businessType', title: '主要经营类目id', width: 100}
                , {field: 'takeawayPhone', title: '外卖电话', width: 100}
                , {field: 'isPlatSend', title: '是否开启了平台配送', width: 100}
                , {field: 'cardUserImg', title: '法人身份证正面', width: 100}
                , {field: 'cardGuohuiImg', title: '法人身份证国徽面照片', width: 100}
                , {field: 'cardHandImg', title: '法人手持身份证正面照片', width: 100}
                , {field: 'businessLicenseImg', title: '营业执照图片', width: 100}
                , {field: 'securityPermitImg', title: '安全许可证图片', width: 100}
                , {field: 'otherVoucherImg', title: '其他凭证', width: 100}
                , {field: 'createTime', title: '创建时间', width: 100}
                , {field: 'updateTime', title: '最近更新时间', width: 100}
                , {field: 'maxDeliveryArea', title: '最大配送范围(单位:M)', width: 100}
            ]]
            , limits: [5, 10, 15]
            , toolbar: '#toolbarDemo'
            ,done() {// 表格渲染完成之后，也就是图片都被渲染好了
                showBigImg();// 渲染大图查看，给这些图片绑定点击事件
            }
        });

        let addOpen;
        let editOpen;

        // 修改商户
        form.on('submit(sureEdit)', function (data) {
            let formData = new FormData(data.form);
            formData.append("merchantId", $("#sureEdit")[0].merchantId);
            // 添加一个文件呢？
            // 添加文件的步骤：首先，第一步：获取file的jsDom对象
            $.ajax({
                url: "/pages/back/merchant/ajaxEdit",// 请求数据服务器地址，只能是当前项目，JSONP才能访问外网（需要服务器配合才能用）
                contentType: false,// 默认就是表单数据(不写)，如果此时要传递的是json字符串，
                // 那么此时就用application/json,如果此时要传递图片"multipart/form-data，还有数组，集合，还有对象，那么contentType必须指定为false
                data: formData,// 要上传的参数
                dataType: 'json',// 服务器响应数据：json,text,html,xml
                error: function () {//请求错误的时候，会触发此函数

                },
                processData: false,//布尔值,一般都不用设置，规定通过请求发送的数据是否转换为查询字符串。默认是 true。如果此时上传的时候，有图片，这里必须设置false,
                success: function (res) {// 请求成功，回调函数,data，指的就是服务器返回的数据
                    if (res.status == 200) {
                        layer.msg(res.msg);
                        tb.reload();// 添加成功数据之后要重载表格
                        if (editOpen != undefined) {
                            layer.close(editOpen);
                        }
                    }
                },
                type: 'post',// ajax请求的方式，post或get
            });
            layer.close(editOpen);
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });


        //监听自定义工具条
        table.on('tool(merchantTable)', function (obj) { //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
            var d = obj.data; //获得当前行数据
            console.log(d)
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            switch (layEvent) {
                case 'checkState':
                    editOpen = layer.open({// 弹框之后，如遇到select标签，radio,checkbox之类，需要使用表单渲染
                        type: 1,
                        area: ['70%', '80%'],
                        btn: ['审核通过', '需重新提交', '审核中', '暂不合作', '待提交','查看审批日志'],
                        btnAlign: 'c',
                        shadeClose: true,
                        title: "商户审批",
                        content: $("#checkStateForm").html(),
                        btn1: function (index, layero) {

                            let note=$("#note").val()

                            let newApprovalStatus = '审核通过';
                            $.post('/pages/back/merchant/ajaxCheckState', {
                                note:note,
                                merchantId: d.merchantId,
                                approvalStatus: newApprovalStatus
                            }, function (res) {
                                if (res.res) {
                                    layer.msg('审核成功');
                                    tb.reload()
                                }
                            });

                            //按钮【按钮一】的回调
                        }
                        , btn2: function (index, layero) {
                            layer.msg('需重新提交')
                            //按钮【按钮二】的回调
                            let newApprovalStatus = '需重新提交';
                            let note=$("#note").val()
                            $.post('/pages/back/merchant/ajaxCheckState', {
                                note:note,
                                merchantId: d.merchantId,
                                approvalStatus: newApprovalStatus
                            }, function (res) {
                                if (res.res) {
                                    layer.msg('审核成功');
                                    tb.reload()
                                }
                            });

                            return false; //开启该代码可禁止点击该按钮关闭

                        }
                        , btn3: function (index, layero) {

                            layer.msg('审核中')
                            //按钮【按钮三】的回调
                            let newApprovalStatus = '审核中';
                            let note=$("#note").val()
                            $.post('/pages/back/merchant/ajaxCheckState', {
                                note:note,
                                merchantId: d.merchantId,
                                approvalStatus: newApprovalStatus
                            }, function (res) {
                                if (res.res) {
                                    layer.msg('审核成功');
                                    tb.reload()
                                }
                            });

                            return false; //开启该代码可禁止点击该按钮关闭
                        }, btn4: function (index, layero) {
                            let note=$("#note").val()
                            layer.msg('暂不合作')
                            //按钮【按钮三】的回调
                            let newApprovalStatus = '暂不合作';
                            $.post('/pages/back/merchant/ajaxCheckState', {
                                note:note,
                                merchantId: d.merchantId,
                                approvalStatus: newApprovalStatus
                            }, function (res) {
                                if (res.res) {
                                    layer.msg('审核成功');
                                    tb.reload()
                                }
                            });

                            return false; //开启该代码可禁止点击该按钮关闭
                        },
                        btn5: function (index, layero) {
                            let note=$("#note").val()
                            layer.msg('待提交')
                            //按钮【按钮三】的回调
                            let newApprovalStatus = '待提交';
                            $.post('/pages/back/merchant/ajaxCheckState', {
                                note:note,
                                merchantId: d.merchantId,
                                approvalStatus: newApprovalStatus
                            }, function (res) {
                                if (res.res) {
                                    layer.msg('审核成功');
                                    tb.reload()
                                }
                            });
                            return false; //开启该代码可禁止点击该按钮关闭
                        },
                        btn6: function (index, layero) {
                            layer.msg('查看审批日志')
                            //按钮【按钮三】的回调

                            logOpen = layer.open({// 弹框之后，如遇到select标签，radio,checkbox之类，需要使用表单渲染
                                type: 1,
                                area: ['600px', '400px'],
                                resize: false,
                                limit:5,
                                title: "审核日志记录",
                                shadeClose: true,
                                content: $("#logDiv").html()
                            });
                            let logsTb = table.render({// 渲染日志表格
                                elem: '#approvalLogsTable'
                                , url: '/pages/back/approval/getMerchantLogsById/' + d.merchantId //服务后台的数据接口
                                , page: true //开启分页
                                , cols: [[ //表头，这里是两个[[开头，两个]]结尾
                                    {field: 'note', title: '备注', width: 130,}
                                    , {field: 'createTime', title: '时间', width: 100}
                                    , {field: 'res', title: '审核结果', width: 80}
                                    , {field: 'approvalUserId', title: '审核人Id', width: 80,}
                                    , {field: 'approvalUserName', title: '审核人名字', width: 100,}
                                ]]
                            });
                            return false; //开启该代码可禁止点击该按钮关闭
                        }
                    });
                    form.render();

                    $("#c_approvalStatus").val(d.approvalStatus)
                    $("#c_merchantId").val(d.merchantId)
                    $("#c_userId").val(d.userId)
                    $("#c_phone").val(d.phone)
                    $("#c_shopName").val(d.shopName)
                    $("#c_shopDetail").val(d.shopDetail)
                    $("#c_email").val(d.email)
                    $("#c_contactName").val(d.contactName)
                    $("#c_pcd").val(d.pcd)
                    $("#c_address").val(d.address)
                    $("#c_location").val(d.location)
                    $("#c_lng").val(d.lng)
                    $("#c_lat").val(d.lat)
                    $("#c_isOpen").val(d.isOpen)
                    $("#c_street").val(d.street)
                    $("#c_title1").val(d.title1)
                    $("#c_title2").val(d.title2)
                    $("#c_title3").val(d.title3)
                    $("#c_minPrice").val(d.minPrice)
                    $("#c_businessStartTime1").val(d.businessStartTime1)
                    $("#c_businessEndTime1").val(d.businessEndTime1)
                    $("#c_businessStartTime2").val(d.businessStartTime2)
                    $("#c_businessEndTime2").val(d.businessEndTime2)
                    $("#c_province").val(d.province)
                    $("#c_businessType").val(d.businessType)
                    $("#c_takeawayPhone").val(d.takeawayPhone)
                    $("#c_shopLogo").attr('src', d.shopLogo)
                    $("#c_doorImg").attr('src', d.doorImg)
                    $("#c_interiorImg").attr('scr', d.interiorImg)
                    $("#c_cardUserImg").attr('src', d.cardUserImg)
                    $("#c_cardGuohuiImg").attr('src', d.cardGuohuiImg)
                    $("#c_cardHandImg").attr('src', d.cardHandImg)
                    $("#c_businessLicenseImg").attr('src', d.businessLicenseImg)
                    $("#c_securityPermitImg").attr('src', d.securityPermitImg)
                    $("#c_otherVoucherImg").attr('src', d.otherVoucherImg)
                    $("#c_createTime").val(d.createTime)
                    $("#c_updateTime").val(d.updateTime)
                    $("#c_maxDeliveryArea").val(d.maxDeliveryArea)


                    break;
                case 'deleteData':
                    layer.msg('删除');
                    let merchantId = obj.data.merchantId;
                    layer.confirm('纳尼？', {
                            btn: ['确认删除', '取消'] //可以无限个按钮
                        }
                        , function (index, layero) {
                            //按钮【按钮一】的回调
                            $.post("/pages/back/merchant/ajaxDeleteMerchant",
                                {merchantId: merchantId}
                                , function (data) {
                                    if (data.status == 200) {
                                        layer.msg("删除成功");
                                        obj.del();
                                    } else {
                                        layer.msg("删除失败");
                                    }

                                })
                            layer.closeAll();
                        }, function (index) {
                            //按钮【按钮二】的回调
                            layer.close(index)
                        });
                    break;
                case 'showMerchantMap':
                    //  直接传递经纬度
                    toggleMap(d.lng,d.lat);
                    break;
            }
            showBigImg();// 渲染大图查看，给这些图片绑定点击事件
        });


        // 头部工具栏监听事件监听事件
        table.on('toolbar(merchantTable)', function (obj) {
            console.log(obj);
            // var checkStatus = table.checkStatus(obj.config.id);
            switch (obj.event) {
                case 'add':
                    addOpen = layer.open({// 弹框之后，如遇到select标签，radio,checkbox之类，需要使用表单渲染
                        type: 1,
                        title: "商品添加",
                        content: $("#addForm").html()
                    });
                    form.render();
                    break;
                case 'delete':
                    let checkStatus = table.checkStatus('merchantTable'); //idTest 即为基础参数 id 对应的值
                    layer.confirm('您确定操作吗?', function (index) {
                        // 第一步，拿到所有选中的行的商户id
                        let checkmerchants = checkStatus.data;//获取选中行的数据
                        deletemerchants(checkmerchants, layer, tb);// 批量删除商户
                        layer.close(index);
                    });
                    break;

                    break;
                case 'dispatchmerchant':
                    layer.msg('分配商户');
                    // 第一步：获取选中的商户
                    let checkS = table.checkStatus('merchantTable'); //idTest 即为基础参数 id 对应的值
                    let checkmerchants = checkS.data;//获取选中行的数据


                    if (checkmerchants.length < 1) {
                        layer.msg("请选择商户");
                        return false;
                    }


                    //第一个实例
                    let systemRolesOpen = layer.open({// 弹框之后，如遇到select标签，radio,checkbox之类，需要使用表单渲染
                        type: 1,
                        offset: '10px',
                        area: '60%',
                        title: "系统级角色列表",
                        content: $("#systemRolesTableDiv").html()
                    });
                    let systemRolesTable = table.render({// 渲染表格
                        elem: '#systemRolesTable'
                        , url: '/pages/back/role/getSystemRoles' //服务后台的数据接口
                        , cols: [[ //表头，这里是两个[[开头，两个]]结尾
                            {field: '', type: 'radio', title: '单选'}
                            , {field: 'name', title: '角色名称', width: 160}
                            , {field: 'flag', title: '标记', width: 160}
                            , {field: 'note', title: '备注', width: 260}
                        ]]
                    });
                    // 第二步：拿到勾选的角色
                    let r;
                    table.on('radio(systemRolesTable)', function (obj) {
                        let role = obj.data;
                        r = {};
                        r.roleId = role.roleId;
                        let ps = [];// 商户数组
                        checkmerchants.forEach((p) => {
                            let merchant = {};
                            merchant.merchantId = p.merchantId;
                            ps.push(merchant)
                        });
                        r.merchantVOS = ps;
                    });
                    $("#addmerchantToRole").click(function () {
                        // 第一步：拿到所有勾选的商户
                        if (checkmerchants.length === 0) {
                            layer.msg('请选中一些商户，先');
                            return false;
                        }
                        if (r == undefined) {
                            layer.msg('请选中一个角色，先');
                            return false;
                        }
                        $.post('/pages/back/merchant/addmerchantToRole', {str: JSON.stringify(r)}, function (res) {// 如果要传递数组还是要用application/json
                            layer.msg(res.msg);
                            layer.closeAll();
                        });
                    });
                    $("#removemerchantFromRole").click(function () {
                        // 第一步：拿到所有勾选的商户
                        if (checkmerchants.length === 0) {
                            layer.msg('请选中一些商户，先');
                            return;
                        }
                        if (r == undefined) {
                            layer.msg('请选中一个角色，先');
                            return;
                        }
                        $.post('/pages/back/merchant/removemerchantFromRole', {str: JSON.stringify(r)}, function (res) {// 如果要传递数组还是要用application/json
                            layer.msg(res.msg);
                            layer.closeAll();
                        });
                    });
                    break;
            }
            ;
        });

        // 模糊搜索
        form.on('submit(selectByInfo)', function (data) {
            console.log(data.field)
            table.reload('merchantTable', {
                url: '/pages/back/merchant/ajaxList'
                , where: data.field
                //设定异步数据接口的额外参数
                , page: {curr: 1}
                //,height: 300
            });
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
    });

    //在输入框输入直接搜索功能
    onInput($("#phone"));
    onInput($("#shopName"));
    onInput($("#shopDetail"));
    onInput($("#email"));
    onInput($("#contactName"));
    onInput($("#pcd"));
    onInput($("#address"));
    onInput($("#approvalStatus"));

    function onInput(jObj) {
        jObj.on({
            'input': function () {
                $("#selectByInfo").click();// 这里直接换成查询按钮点击事件
            }
        })
    }
</script>

</body>

</html>
